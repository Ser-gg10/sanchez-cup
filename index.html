<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>S√°nchez Cup ¬∑ Torneo de F√∫tbol 3v3</title>
<meta name="theme-color" content="#7b1e2b">
<style>
:root{--bg:#f6f2f3;--card:#ffffff;--text:#222;--primary:#7b1e2b;--secondary:#4d111a;--accent:#c44a5a}
body.dark{--bg:#12090b;--card:#1e1416;--text:#f1eaea;--primary:#a73344;--secondary:#7b1e2b}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto;background:var(--bg);color:var(--text)}
header{padding:40px 15px;text-align:center;background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff}
nav{position:sticky;top:0;display:flex;justify-content:center;gap:10px;flex-wrap:wrap;padding:10px;background:var(--secondary);z-index:10}
nav a,nav button{color:#fff;background:none;border:none;font-weight:800;cursor:pointer}
section{padding:30px 15px;max-width:1200px;margin:auto}
h2{text-align:center;color:var(--primary)}
.card{background:var(--card);border-radius:18px;padding:20px;box-shadow:0 10px 25px rgba(0,0,0,.25);margin-bottom:25px}
label{font-weight:700;margin-top:12px;display:block}
input{width:100%;padding:12px;margin-top:6px;border-radius:10px;border:1px solid #999}
.players{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px}
button.main{margin-top:12px;width:100%;padding:14px;border:none;border-radius:30px;background:var(--primary);color:#fff;font-weight:800}
button.alt{background:var(--accent)}
.match{display:grid;grid-template-columns:1fr auto 1fr auto;align-items:center;gap:10px}
.score{font-size:1.3em;font-weight:800}
.bracket{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:15px}
.round{background:var(--card);padding:15px;border-radius:14px;box-shadow:0 6px 15px rgba(0,0,0,.2)}
.small{font-size:.9em;opacity:.85;text-align:center}
.table-wrap{overflow:auto}
.admin-only{display:none}
.hidden{display:none}
</style>
</head>
<body>
<header>
<h1>S√°nchez Cup</h1>
<p>Torneo de F√∫tbol 3v3</p>
</header>
<nav>
<a href="#inscripciones">Inscripciones</a>
<a href="#liga">Liga</a>
<a href="#clasificacion">Clasificaci√≥n</a>
<a href="#ranking">Ranking</a>
<a href="#eliminatorias">Eliminatorias</a>
<button onclick="toggleDark()">üåô</button>
<button onclick="loginAdmin()">üîê Admin</button>
<button onclick="modoTV()">üì∫ TV</button>
</nav>

<section id="inscripciones">
<h2>Inscripci√≥n de Equipos</h2>
<div class="card">
<form id="formEquipo">
<label>Nombre del equipo</label>
<input id="equipo" required>
<div class="players">
<input class="jugador" placeholder="Nombre Apellido" required>
<input class="jugador" placeholder="Nombre Apellido" required>
<input class="jugador" placeholder="Nombre Apellido" required>
</div>
<button class="main">Inscribir equipo</button>
<p class="small">Consejo: escribe siempre los nombres igual para estad√≠sticas consistentes.</p>
</form>
</div>
</section>

<section id="liga">
<h2>Fase Liga</h2>
<div class="card">
<button class="main alt" onclick="generarLiga()">Generar partidos</button>
<button class="main" onclick="exportar()">Descargar copia del torneo</button>
<button class="main alt" onclick="importar()">Cargar copia</button>
<input type="file" id="fileImport" hidden>
<p id="adminMsg" style="text-align:center;font-weight:700"></p>
<div id="partidos"></div>
</div>
</section>

<section id="clasificacion">
<h2>Clasificaci√≥n</h2>
<div class="card table-wrap">
<table width="100%"><thead><tr><th>#</th><th>Equipo</th><th>PJ</th><th>PG</th><th>PE</th><th>PP</th><th>GF</th><th>GC</th><th>DG</th><th>Pts</th></tr></thead><tbody id="tablaClas"></tbody></table>
</div>
</section>

<section id="ranking">
<h2>Ranking Individual</h2>
<div class="card table-wrap">
<h3>‚öΩ Goleadores</h3>
<table width="100%"><thead><tr><th>Jugador</th><th>Goles</th></tr></thead><tbody id="rankingGoles"></tbody></table>
<h3>üéØ Asistencias</h3>
<table width="100%"><thead><tr><th>Jugador</th><th>Asist.</th></tr></thead><tbody id="rankingAsist"></tbody></table>
</div>
</section>

<section id="eliminatorias">
<h2>Fase Eliminatoria</h2>
<div class="card">
<button class="main" onclick="generarEliminatorias()">Generar eliminatorias</button>
<div class="bracket" id="bracket"></div>
</div>
</section>

<script>
// Enlaces DOM (evita fallos en navegadores que no crean variables globales por id)
const formEquipo=document.getElementById('formEquipo');
const equipo=document.getElementById('equipo');
const adminMsg=document.getElementById('adminMsg');
const tablaClas=document.getElementById('tablaClas');
const rankingGoles=document.getElementById('rankingGoles');
const rankingAsist=document.getElementById('rankingAsist');
const fileImport=document.getElementById('fileImport');
const LS=k=>JSON.parse(localStorage.getItem(k))||[];
const SS=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
let admin=false; // no persistir en localStorage

function toggleDark(){document.body.classList.toggle('dark')}
function loginAdmin(){const p=prompt('Contrase√±a admin');if(p==='sanchez'){admin=true;adminMsg.textContent='Modo admin activo';renderPartidos();}else{alert('Contrase√±a incorrecta');}}

formEquipo.onsubmit=e=>{
 e.preventDefault();
 const nombre=equipo.value.trim();
 if(!nombre) return;
 const jugadores=[...document.querySelectorAll('.jugador')].map(j=>({
  nombre:j.value.trim(),
  key:j.value.trim().toLowerCase()
 }));
 if(jugadores.some(j=>!j.nombre)) return alert('Completa los 3 jugadores');
 const eq=LS('equipos');
 eq.push({nombre,jugadores});
 SS('equipos',eq);
 formEquipo.reset();
 alert('Equipo inscrito');
};

function generarLiga(){
 const equipos=LS('equipos');
 if(equipos.length<2){alert('Necesitas al menos 2 equipos');return;}
 let p=[];
 for(let i=0;i<equipos.length;i++)for(let j=i+1;j<equipos.length;j++)p.push({a:equipos[i].nombre,b:equipos[j].nombre,acta:null});
 SS('partidos',p);// Persistir modo oscuro
(function(){
  const d=localStorage.getItem('dark')==='1';
  if(d) document.body.classList.add('dark');
})();

// Marcar controles solo admin
document.querySelectorAll("button[onclick*='generarLiga'],button[onclick*='exportar'],button[onclick*='importar'],button[onclick*='generarEliminatorias']").forEach(b=>b.classList.add('admin-only'));

function setAdminUI(){
  document.querySelectorAll('.admin-only').forEach(el=>el.style.display=admin?'block':'none');
}

// Mejorar login
const _loginAdmin=loginAdmin; loginAdmin=function(){
  const p=prompt('Contrase√±a admin');
  if(p==='sanchez'){admin=true;adminMsg.textContent='Modo admin activo';setAdminUI();renderPartidos();}
  else alert('Contrase√±a incorrecta');
}

// Dark mode persistente
const _toggleDark=toggleDark; toggleDark=function(){
  document.body.classList.toggle('dark');
  localStorage.setItem('dark',document.body.classList.contains('dark')?'1':'0');
}

// TV: abrir misma p√°gina en modo TV
function modoTV(){
  const url=new URL(window.location.href);
  url.searchParams.set('tv','1');
  window.open(url.toString(),'tv');
}

function initTV(){
  const p=new URLSearchParams(location.search);
  if(p.get('tv')!=='1') return;
  // ocultar todo excepto clasificaci√≥n
  document.querySelectorAll('header,nav,#inscripciones,#liga,#ranking,#eliminatorias').forEach(e=>e.classList.add('hidden'));
  document.querySelector('#clasificacion h2').textContent='Clasificaci√≥n (Modo TV)';
  document.body.classList.add('dark');
  const refrescar=()=>{clasificacion();};
  window.addEventListener('storage',refrescar);
  setInterval(refrescar,2000);
}

initTV();
setAdminUI();
renderPartidos();calcularTodo();
}

function renderPartidos(){
 const c=document.getElementById('partidos');c.innerHTML='';
 LS('partidos').forEach((p,i)=>{
  const d=document.createElement('div');d.className='card match';
  d.innerHTML=`<div>${p.a}</div><div class='score'>${p.acta?`${p.acta.ga}-${p.acta.gb}`:'vs'}</div><div>${p.b}</div>${admin?`<button class='main' onclick='editarActa(${i})'>Acta</button>`:''}`;
  c.appendChild(d);
 });
}

function num(v){v=parseInt(v);return Math.max(0,isNaN(v)?0:v)}

function editarActa(i){
 if(!admin) return alert('Solo admin');
 const partidos=LS('partidos');const p=partidos[i];const equipos=LS('equipos');
 let ga=0,gb=0,datos={};
 equipos.find(e=>e.nombre===p.a).jugadores.forEach(j=>{const g=num(prompt(`Goles ${j.nombre}`,0));const a=num(prompt(`Asistencias ${j.nombre}`,0));ga+=g;datos[j.key]={g,a,n:j.nombre};});
 equipos.find(e=>e.nombre===p.b).jugadores.forEach(j=>{const g=num(prompt(`Goles ${j.nombre}`,0));const a=num(prompt(`Asistencias ${j.nombre}`,0));gb+=g;datos[j.key]={g,a,n:j.nombre};});
 p.acta={ga,gb,datos};partidos[i]=p;SS('partidos',partidos);renderPartidos();calcularTodo();
}

function calcularTodo(){clasificacion();ranking();}

function clasificacion(){
 const eq=LS('equipos').map(e=>({nombre:e.nombre,PJ:0,PG:0,PE:0,PP:0,GF:0,GC:0,pts:0}));
 LS('partidos').forEach(p=>{if(!p.acta)return;const A=eq.find(e=>e.nombre===p.a),B=eq.find(e=>e.nombre===p.b);A.PJ++;B.PJ++;A.GF+=p.acta.ga;A.GC+=p.acta.gb;B.GF+=p.acta.gb;B.GC+=p.acta.ga;if(p.acta.ga>p.acta.gb){A.PG++;A.pts+=3;B.PP++;}else if(p.acta.ga<p.acta.gb){B.PG++;B.pts+=3;A.PP++;}else{A.PE++;B.PE++;A.pts++;B.pts++;}});
 eq.forEach(e=>e.DG=e.GF-e.GC);
 eq.sort((a,b)=>b.pts-a.pts||b.DG-a.DG||b.GF-a.GF);
 tablaClas.innerHTML='';
 eq.forEach((e,i)=>tablaClas.innerHTML+=`<tr><td>${i+1}</td><td>${e.nombre}</td><td>${e.PJ}</td><td>${e.PG}</td><td>${e.PE}</td><td>${e.PP}</td><td>${e.GF}</td><td>${e.GC}</td><td>${e.DG}</td><td>${e.pts}</td></tr>`);
 SS('clasificacion',eq);
 if(eq[0]) adminMsg.textContent='L√≠der actual: '+eq[0].nombre;
}

function ranking(){
 const g={},a={},display={};
 LS('equipos').forEach(eq=>eq.jugadores.forEach(j=>{g[j.key]=0;a[j.key]=0;display[j.key]=j.nombre;}));
 LS('partidos').forEach(p=>{if(!p.acta)return;Object.entries(p.acta.datos).forEach(([k,d])=>{g[k]=(g[k]||0)+d.g;a[k]=(a[k]||0)+d.a;display[k]=d.n||display[k];});});
 rankingGoles.innerHTML='';rankingAsist.innerHTML='';
 Object.entries(g).sort((x,y)=>y[1]-x[1]).forEach(([k,v])=>rankingGoles.innerHTML+=`<tr><td>${display[k]||k}</td><td>${v}</td></tr>`);
 Object.entries(a).sort((x,y)=>y[1]-x[1]).forEach(([k,v])=>rankingAsist.innerHTML+=`<tr><td>${display[k]||k}</td><td>${v}</td></tr>`);
}

function generarEliminatorias(){
 if(!admin)return alert('Solo admin');
 const clas=LS('clasificacion');if(clas.length<4)return alert('Necesitas al menos 4 equipos');
 const top=clas.slice(0,4);const b=document.getElementById('bracket');b.innerHTML='';
 b.innerHTML+=`<div class='round'><strong>Semifinal 1</strong><p>${top[0].nombre} vs ${top[3].nombre}</p></div>`;
 b.innerHTML+=`<div class='round'><strong>Semifinal 2</strong><p>${top[1].nombre} vs ${top[2].nombre}</p></div>`;
 b.innerHTML+=`<div class='round'><strong>Final</strong><p>Ganadores semifinales</p></div>`;
}

function exportar(){
 const data={equipos:LS('equipos'),partidos:LS('partidos'),clasificacion:LS('clasificacion')};
 const blob=new Blob([JSON.stringify(data)],{type:'application/json'});
 const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='sanchez_cup_backup.json';a.click();
}
function importar(){fileImport.click();}
fileImport.onchange=e=>{const file=e.target.files[0];const reader=new FileReader();reader.onload=()=>{try{const d=JSON.parse(reader.result);SS('equipos',d.equipos||[]);SS('partidos',d.partidos||[]);SS('clasificacion',d.clasificacion||[]);renderPartidos();calcularTodo();alert('Copia cargada');}catch{alert('Archivo inv√°lido');}};reader.readAsText(file);};

function modoTV(){
 const w=window.open('','tv');
 w.document.write(`<html><head><title>S√°nchez Cup TV</title><meta name='viewport' content='width=device-width,initial-scale=1'><style>body{margin:0;font-family:system-ui;background:#12090b;color:#fff}h1{text-align:center;margin:10px 0}table{width:100%;border-collapse:collapse}th,td{padding:10px;border-bottom:1px solid #444;text-align:center}tr:first-child{background:#7b1e2b;font-weight:800}</style></head><body><h1>Clasificaci√≥n</h1><table><thead><tr><th>#</th><th>Equipo</th><th>PJ</th><th>DG</th><th>Pts</th></tr></thead><tbody id='t'></tbody></table><script>function r(){const c=JSON.parse((window.opener?.localStorage||localStorage).getItem('clasificacion')||'[]');const t=document.getElementById('t');t.innerHTML='';c.forEach((e,i)=>t.innerHTML+=`<tr><td>${i+1}</td><td>${e.nombre}</td><td>${e.PJ}</td><td>${e.DG}</td><td>${e.pts}</td></tr>`);}r();setInterval(r,2000);<\/script></body></html>`);
}

renderPartidos();calcularTodo();
</script>
</body>
</html>


